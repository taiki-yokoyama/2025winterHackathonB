# 実装計画

- [x] 1. データベーススキーマの作成




  - docker/mysql/init.sqlに3つのテーブル（team_plans, team_chats, individual_evaluations）を追加
  - 外部キー制約とインデックスを設定
  - _要件: 9.1, 9.2, 9.3_


- [x] 2. データベースアクセス関数の実装




  - [x] 2.1 チーム計画関連の関数を実装


    - saveTeamPlan(): チーム計画をデータベースに保存
    - getTeamPlans(): 全てのチーム計画を取得
    - _要件: 1.1, 1.3_

  - [x] 2.2 プロパティテスト: チーム計画の保存整合性





    - **プロパティ1: チーム計画の保存整合性**
    - **検証: 要件 1.1, 9.1**

  - [x] 2.3 チームチャット関連の関数を実装

    - saveChatMessage(): チャットメッセージをデータベースに保存
    - getChatMessages(): 全てのチャットメッセージをタイムスタンプ順に取得
    - _要件: 2.1, 2.3_

  - [ ]* 2.4 プロパティテスト: チャットメッセージの保存整合性とソート順序
    - **プロパティ3: チャットメッセージの保存整合性**
    - **プロパティ4: メッセージのタイムスタンプ順序**
    - **検証: 要件 2.1, 2.3, 9.2**

  - [x] 2.5 個人評価関連の関数を実装

    - saveEvaluation(): 個人評価をデータベースに保存
    - getEvaluationsByTargetUser(): 特定ユーザーへの評価を取得
    - getActionProposalsByTargetUser(): 特定ユーザーへのアクション提案を取得
    - _要件: 4.4, 5.4, 6.2, 7.1_

  - [ ]* 2.6 プロパティテスト: 評価データの保存整合性とフィルタリング
    - **プロパティ6: 評価データの保存整合性**
    - **プロパティ7: 評価の取得フィルタリング**
    - **検証: 要件 4.4, 5.4, 7.1, 8.2, 9.3**

  - [ ]* 2.7 プロパティテスト: アクション提案の保存と取得
    - **プロパティ8: アクション提案の保存と取得**
    - **プロパティ9: アクション提案のタイムスタンプ順序**
    - **検証: 要件 6.2, 6.3, 6.5**

  - [ ]* 2.8 プロパティテスト: 評価のタイムスタンプ順序
    - **プロパティ10: 評価のタイムスタンプ順序**
    - **検証: 要件 7.5**

- [x] 3. バリデーション関数の実装





  - [x] 3.1 入力バリデーション関数を実装










    - validateNotEmpty(): 空文字列と空白のみの文字列をチェック
    - validateRating(): 評価が1-4の範囲内かチェック
    - validateEvaluationForm(): 評価フォーム全体のバリデーション
    - _要件: 1.4, 2.4, 8.1_

  - [ ]* 3.2 プロパティテスト: 空入力のバリデーション
    - **プロパティ2: 空入力のバリデーション**
    - **検証: 要件 1.4, 2.4**

  - [ ]* 3.3 プロパティテスト: 必須フィールドのバリデーション
    - **プロパティ12: 必須フィールドのバリデーション**
    - **検証: 要件 8.1**

  - [ ]* 3.4 プロパティテスト: SQLインジェクション防止
    - **プロパティ13: SQLインジェクション防止**
    - **検証: 要件 9.5**



- [x] 4. 計算関数の実装







  - [x] 4.1 平均スコア計算関数を実装



    - calculateAverageRating(): 評価配列から平均を計算
    - calculateSummaryScores(): コードと人格の平均スコアを計算
    - _要件: 7.3_

  - [ ]* 4.2 プロパティテスト: 平均スコア計算の正確性
    - **プロパティ11: 平均スコア計算の正確性**
    - **検証: 要件 7.3**


- [x] 5. チェックポイント - 全てのテストが通ることを確認








  - 全てのテストが通ることを確認し、問題があればユーザーに質問する


- [x] 6. チーム計画機能のバックエンド実装






  - [x] 6.1 src/check/check.phpにチーム計画送信処理を追加







    - POSTリクエストを処理
    - バリデーション実行
    - データベースに保存
    - JSONレスポンスを返す
    - _要件: 1.1, 1.4, 1.5_

  - [ ]* 6.2 ユニットテスト: チーム計画送信処理
    - 正常系のテスト
    - バリデーションエラーのテスト
    - データベースエラーのテスト


- [x] 7. チームチャット機能のバックエンド実装




  - [x] 7.1 src/check/check.phpにチャットメッセージ送信処理を追加



















    - POSTリクエストを処理
    - バリデーション実行
    - データベースに保存
    - JSONレスポンスを返す
    - _要件: 2.1, 2.4_

  - [x] 7.2 src/check/check.phpにチャットメッセージ取得処理を追加


    - GETリクエストを処理
    - データベースから取得
    - JSONレスポンスを返す
    - _要件: 2.3_

  - [ ]* 7.3 ユニットテスト: チャットメッセージ処理
    - メッセージ送信のテスト
    - メッセージ取得のテスト
    - バリデーションエラーのテスト


- [x] 8. 個人評価機能のバックエンド実装



  - [x] 8.1 src/check/check.phpに個人評価送信処理を追加







    - POSTリクエストを処理
    - 全フィールドのバリデーション実行
    - データベースに単一レコードとして保存
    - JSONレスポンスを返す
    - _要件: 3.4, 4.4, 5.4, 6.2, 8.1, 8.2_

  - [ ]* 8.2 ユニットテスト: 個人評価送信処理
    - 完全な評価データの送信テスト
    - オプションフィールド（コメント、アクション提案）のテスト
    - バリデーションエラーのテスト


- [x] 9. 評価閲覧機能のバックエンド実装



  - [x] 9.1 src/check/result.phpに評価取得処理を追加











    - 現在のユーザーIDを取得
    - データベースから評価を取得
    - サマリースコアを計算
    - 評価データを表示用に整形
    - _要件: 4.5, 5.5, 7.1, 7.2, 7.3, 7.4, 7.5_

  - [ ]* 9.2 ユニットテスト: 評価閲覧処理
    - 評価取得のテスト
    - サマリースコア計算のテスト
    - 空の評価セットのテスト


- [ ] 10. チェックポイント - バックエンド機能のテスト









  - 全てのテストが通ることを確認し、問題があればユーザーに質問する

- [ ] 11. フロントエンド: チーム計画機能の実装

  - [ ] 11.1 src/check/check.phpのチーム計画フォームにJavaScript処理を追加

    - フォーム送信イベントハンドラー
    - バリデーション
    - Fetch APIでPOSTリクエスト送信
    - 成功時にテキストエリアをクリア
    - エラー時にメッセージ表示
    - _要件: 1.1, 1.4, 1.5_


- [x] 12. フロントエンド: チームチャット機能の実装






















  - [x] 12.1 src/check/check.phpのチャットエリアにJavaScript処理を追加





    - ページ読み込み時にメッセージ取得
    - メッセージ送信イベントハンドラー
    - バリデーション
    - Fetch APIでPOST/GETリクエスト
    - チャットエリアに動的にメッセージ追加
    - _要件: 2.1, 2.2, 2.3, 2.4, 2.5_


- [x] 13. フロントエンド: 個人評価機能の実装




  - [x] 13.1 src/check/check.phpの個人評価フォームにJavaScript処理を追加









    - 対象ユーザー選択の状態管理
    - 評価ボタンの選択状態管理
    - フォーム送信イベントハンドラー
    - バリデーション
    - Fetch APIでPOSTリクエスト送信
    - 成功時にフォームをリセット
    - エラー時にメッセージ表示
    - _要件: 3.2, 3.3, 3.4, 4.1, 4.2, 5.1, 5.2, 8.1, 8.3, 8.4, 8.5_


- [x] 14. フロントエンド: タブ切り替え機能の改善



  - [x] 14.1 src/check/check.phpのタブ切り替え機能を改善







    - フォームデータの保持機能を追加
    - タブ切り替え時のアニメーション
    - アクティブタブの視覚的フィードバック
    - _要件: 10.1, 10.2, 10.3, 10.4, 10.5_


- [x] 15. 既存ページとの統合: プランページ





  - [x] 15.1 src/plan/index.phpにチーム計画表示機能を追加









    - チーム計画取得関数を呼び出し
    - 各メンバーのセクションにチーム計画を表示
    - 適切なスタイリングを適用
    - _要件: 1.2, 1.3_

- [x] 16. 既存ページとの統合: アクションページ







  - [x] 16.1 src/action/index.phpにアクション提案表示機能を追加





    - 現在のユーザーIDを取得
    - アクション提案取得関数を呼び出し
    - 提案を表示（評価者名、日付、提案内容）
    - 適切なスタイリングを適用
    - _要件: 6.3, 6.5_


- [x] 17. エラーハンドリングとセキュリティの強化




  - [x] 17.1 全てのPHPファイルにエラーハンドリングを追加




    - try-catchブロック
    - エラーログ記録
    - ユーザーフレンドリーなエラーメッセージ
    - _要件: 9.4_


  - [x] 17.2 セキュリティ対策を実装



    - XSS対策（htmlspecialchars）
    - CSRF対策（トークン）
    - セッション検証
    - _要件: 9.5_

- [ ] 18. 最終チェックポイント - 全機能のテスト
  - 全てのテストが通ることを確認し、問題があればユーザーに質問する
