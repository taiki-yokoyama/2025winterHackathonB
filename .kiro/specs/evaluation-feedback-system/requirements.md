# 要件定義書

## はじめに

本文書は、チームメンバーが互いの作業に対してフィードバックを提供し、アクション項目を提案できる評価・フィードバックシステムの要件を定義します。システムは2つの主要コンポーネントで構成されます：チーム全体へのフィードバック（チーム計画とグループディスカッション）と個人へのフィードバック（コード/人格評価とアクション提案）。本システムは既存のプランページとアクションページと統合され、完全なPDCAサイクルワークフローを実現します。

## 用語集

- **評価システム**: チームメンバーがフィードバックを送信・閲覧できるWebアプリケーション
- **チーム計画**: プラン一覧ページで全チームメンバーに表示される共有アクションプラン
- **チームチャット**: 全チームメンバーがメッセージを投稿・閲覧できるグループディスカッションエリア
- **個人評価**: コード品質と人格の評価（1-4スケール）で構成される個人向けフィードバック
- **アクション提案**: 特定のチームメンバーに送信される今後の作業に関する提案
- **対象ユーザー**: 個人評価またはアクション提案を受け取るチームメンバー
- **評価者**: フィードバックや評価を送信するチームメンバー
- **プランページ**: src/plan/index.phpにある、チームメンバーの計画を表示する既存ページ
- **アクションページ**: src/action/index.phpにある、アクション提案を表示する既存ページ
- **結果ページ**: src/check/result.phpにある、現在のユーザーが受け取った評価を表示するページ

## 要件

### 要件1

**ユーザーストーリー:** チームメンバーとして、チーム計画を送信したい。そうすることで、全チームメンバーがプラン一覧ページで私たちの共通目標を見ることができる。

#### 受入基準

1. WHEN 評価者がチーム計画のテキストエリアにテキストを入力し送信ボタンをクリックしたとき、THEN 評価システムは計画をタイムスタンプと共にデータベースに保存しなければならない
2. WHEN チーム計画が保存されたとき、THEN 評価システムはプランページのチームメンバー一覧に全ユーザー向けに計画を表示しなければならない
3. WHEN プランページがチームビューを読み込むとき、THEN 評価システムは全てのチーム計画を取得し、各メンバーの計画セクションに表示しなければならない
4. WHEN チーム計画のテキストエリアが空で送信ボタンがクリックされたとき、THEN 評価システムは送信を防止し、バリデーションエラーメッセージを表示しなければならない
5. WHEN チーム計画が正常に送信されたとき、THEN 評価システムはテキストエリアをクリアし、成功確認メッセージを表示しなければならない

### 要件2

**ユーザーストーリー:** チームメンバーとして、チームチャットにメッセージを投稿したい。そうすることで、作業について全チームメンバーとコミュニケーションできる。

#### 受入基準

1. WHEN 評価者がチームチャットの入力フィールドにテキストを入力し送信ボタンをクリックしたとき、THEN 評価システムは送信者の識別情報とタイムスタンプと共にメッセージをデータベースに保存しなければならない
2. WHEN チームチャットメッセージが保存されたとき、THEN 評価システムはチャットエリアに即座にメッセージを表示しなければならない
3. WHEN 評価ページが読み込まれたとき、THEN 評価システムは全てのチームチャットメッセージをタイムスタンプ順に取得し、チャットエリアに表示しなければならない
4. WHEN チームチャット入力が空で送信ボタンがクリックされたとき、THEN 評価システムは送信を防止しなければならない
5. WHEN メッセージがチャットエリアに表示されるとき、THEN 評価システムは送信者のアバター、名前、メッセージ内容を適切な視覚スタイルで表示しなければならない

### 要件3

**ユーザーストーリー:** チームメンバーとして、個人評価の対象ユーザーを選択したい。そうすることで、特定のチームメンバーに個別化されたフィードバックを提供できる。

#### 受入基準

1. WHEN 個人評価タブが読み込まれたとき、THEN 評価システムは全ての利用可能なチームメンバーを選択可能なオプションとして表示しなければならない
2. WHEN 評価者がチームメンバーオプションをクリックしたとき、THEN 評価システムはそのメンバーを選択された対象ユーザーとしてマークしなければならない
3. WHEN 対象ユーザーが選択されたとき、THEN 評価システムは選択を示す視覚的フィードバックを提供しなければならない
4. WHEN 対象ユーザーを選択せずに評価フォームが送信されたとき、THEN 評価システムはデフォルトで選択されているユーザーを使用しなければならない
5. 評価システムは常に正確に1人の対象ユーザーが選択されていることを保証しなければならない

### 要件4

**ユーザーストーリー:** チームメンバーとして、他のメンバーのコード品質を1-4のスケールで評価したい。そうすることで、技術的な作業に対して構造化されたフィードバックを提供できる。

#### 受入基準

1. WHEN 評価者がコード評価ボタン（1-4）をクリックしたとき、THEN 評価システムはその評価を選択済みとしてマークしなければならない
2. WHEN コード評価が選択されたとき、THEN 評価システムは選択された値を示す視覚的フィードバックを提供しなければならない
3. WHEN 評価者がコードコメントフィールドにテキストを入力したとき、THEN 評価システムはオプションのコメントを受け入れて保存しなければならない
4. WHEN 評価フォームが送信されたとき、THEN 評価システムはコード評価とオプションのコメントを対象ユーザーに関連付けてデータベースに保存しなければならない
5. WHEN 対象ユーザーが結果ページを閲覧したとき、THEN 評価システムは評価者からのコード評価とコメントを表示しなければならない

### 要件5

**ユーザーストーリー:** チームメンバーとして、他のメンバーの人格を1-4のスケールで評価したい。そうすることで、協力とコミュニケーションスキルに対するフィードバックを提供できる。

#### 受入基準

1. WHEN 評価者が人格評価ボタン（1-4）をクリックしたとき、THEN 評価システムはその評価を選択済みとしてマークしなければならない
2. WHEN 人格評価が選択されたとき、THEN 評価システムは選択された値を示す視覚的フィードバックを提供しなければならない
3. WHEN 評価者が人格コメントフィールドにテキストを入力したとき、THEN 評価システムはオプションのコメントを受け入れて保存しなければならない
4. WHEN 評価フォームが送信されたとき、THEN 評価システムは人格評価とオプションのコメントを対象ユーザーに関連付けてデータベースに保存しなければならない
5. WHEN 対象ユーザーが結果ページを閲覧したとき、THEN 評価システムは評価者からの人格評価とコメントを表示しなければならない

### 要件6

**ユーザーストーリー:** チームメンバーとして、他のメンバーにアクション項目を提案したい。そうすることで、作業の改善や次のステップを提案できる。

#### 受入基準

1. WHEN 評価者がアクション提案フィールドにテキストを入力したとき、THEN 評価システムは入力を受け入れなければならない
2. WHEN アクション提案を含む評価フォームが送信されたとき、THEN 評価システムは提案を対象ユーザーに関連付けてデータベースに保存しなければならない
3. WHEN 対象ユーザーがアクションページを閲覧したとき、THEN 評価システムは評価者の名前とタイムスタンプと共にアクション提案を表示しなければならない
4. WHEN フォーム送信時にアクション提案フィールドが空のとき、THEN 評価システムはアクション提案なしで送信を許可しなければならない
5. WHEN ユーザーに対して複数のアクション提案が存在するとき、THEN 評価システムは全ての提案をタイムスタンプ順に最新のものを最初に表示しなければならない

### 要件7

**ユーザーストーリー:** チームメンバーとして、自分が受け取った全ての評価を閲覧したい。そうすることで、チームメイトが自分の作業と行動をどう認識しているか理解できる。

#### 受入基準

1. WHEN ユーザーが結果ページに移動したとき、THEN 評価システムはユーザーが対象ユーザーである全ての評価を取得しなければならない
2. WHEN 評価を表示するとき、THEN 評価システムは評価者の名前、アバター、コード評価、人格評価、両方のコメントを表示しなければならない
3. WHEN サマリースコアを計算するとき、THEN 評価システムは全てのコード評価の平均と全ての人格評価の平均を別々に計算しなければならない
4. WHEN ユーザーに対する評価が存在しないとき、THEN 評価システムは評価が受け取られていないことを示すメッセージを表示しなければならない
5. WHEN 評価が表示されるとき、THEN 評価システムはそれらをタイムスタンプ順に最新のものを最初に並べなければならない

### 要件8

**ユーザーストーリー:** チームメンバーとして、評価フォームで全てのデータを一緒に送信したい。そうすることで、1回の操作で完全なフィードバックを提供できる。

#### 受入基準

1. WHEN 評価者が個人評価フォームの送信ボタンをクリックしたとき、THEN 評価システムは全ての必須フィールドを検証しなければならない
2. WHEN フォーム検証が通過したとき、THEN 評価システムは対象ユーザー選択、コード評価、コードコメント、人格評価、人格コメント、アクション提案を単一の評価レコードとして保存しなければならない
3. WHEN 評価が正常に保存されたとき、THEN 評価システムは成功確認メッセージを表示しなければならない
4. WHEN 評価が正常に保存されたとき、THEN 評価システムは全てのフォームフィールドをクリアし、デフォルト状態にリセットしなければならない
5. IF フォーム検証が失敗したとき、THEN 評価システムはどのフィールドを修正する必要があるかを示す具体的なエラーメッセージを表示しなければならない

### 要件9

**ユーザーストーリー:** システム管理者として、評価データをデータベースに永続的に保存したい。そうすることで、フィードバック履歴が時間経過とともに維持される。

#### 受入基準

1. 評価システムはチーム計画を、計画テキスト、作成者ユーザーID、作成タイムスタンプのフィールドを持つデータベーステーブルに保存しなければならない
2. 評価システムはチームチャットメッセージを、メッセージテキスト、送信者ユーザーID、作成タイムスタンプのフィールドを持つデータベーステーブルに保存しなければならない
3. 評価システムは個人評価を、評価者ユーザーID、対象ユーザーID、コード評価、コードコメント、人格評価、人格コメント、アクション提案、作成タイムスタンプのフィールドを持つデータベーステーブルに保存しなければならない
4. WHEN データベース操作が失敗したとき、THEN 評価システムはエラーをログに記録し、ユーザーフレンドリーなエラーメッセージを表示しなければならない
5. 評価システムはSQLインジェクション脆弱性を防ぐために、プリペアドステートメントまたはパラメータ化クエリを使用しなければならない

### 要件10

**ユーザーストーリー:** チームメンバーとして、チームタブと個人評価タブを切り替えたい。そうすることで、異なるタイプのフィードバック機能にアクセスできる。

#### 受入基準

1. WHEN 評価ページが読み込まれたとき、THEN 評価システムはデフォルトでチームタブをアクティブとして表示しなければならない
2. WHEN 評価者が個人タブボタンをクリックしたとき、THEN 評価システムはチームコンテンツを非表示にし、個人評価フォームを表示しなければならない
3. WHEN 評価者がチームタブボタンをクリックしたとき、THEN 評価システムは個人コンテンツを非表示にし、チームフィードバックエリアを表示しなければならない
4. WHEN タブがアクティブのとき、THEN 評価システムはアクティブ状態を示す視覚的スタイリングを適用しなければならない
5. WHEN タブを切り替えるとき、THEN 評価システムは以前アクティブだったタブの未保存フォームデータを保持しなければならない
